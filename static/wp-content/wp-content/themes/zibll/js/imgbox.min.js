(function(t,e){"use strict";function i(i,a,s){function n(){u(),s.exclude&&(i+=":not("+s.exclude+")");var e=a?a+" "+i:i;a=!!s.group&&a,setTimeout(function(){c(i,a)},1e3),W.data("imgbox-ison-"+e)||(W.on("click",e,function(){var e=t(this);o(e,a)}),W.data("imgbox-ison-"+e,!0))}function o(e,i){var a=r(e,i);if(a.slide){t(T+" .swiper-imgbox .swiper-wrapper").html(a.slide),s.thumbs&&t(T+" .swiper-thumbsbox .swiper-wrapper").html(a.thumbs);var n=~~e.attr("imgbox-index")||0;setTimeout(function(){s.thumbs&&V.update(),L.update(),L.slideToLoop(n,10),L.autoplay.stop(),g(n,a.length),x()},10),z(e)}}function r(e,i){var a=e.data(j);if(a)return a;var s=i?t(e.parents(i)[0]):{};if(s.length){var n=s.data(j);if(n&&n.node_length==l(s))return n}return d(e,s)}function l(t){return t.find(i).length}function c(e,i){i?t(i).each(function(){var i=t(this);i.data(j)||d(i.find(e).eq(0),i)}):t(e).each(function(){var e=t(this);e.data(j)||d(e,{})})}function d(e,a){var n={slide:"",thumbs:"",length:0};if(a.length){var o=0;a.find(i).each(function(e){0==e&&(o=0);var i=t(this);q(i)||(i.attr("imgbox-index",o),n.slide+=S(i),n.length=o+1,s.thumbs&&(n.thumbs+=E(i)),o++)}),n.node_length=l(a),a.data(j,n)}else q(e)||e.find("img").length||(n.slide=S(e),n.length=o,e.data(j,n));return n}function u(){if(!I.length){var e='<div class="swiper-imgbox"><div class="swiper-wrapper"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-left counter-con"></div></div>',i='<div class="swiper-thumbsbox"><div class="swiper-wrapper"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-center right-top"><i class="hide-but fa fa-angle-down em12"></i></div></div>',a=s.down?'<a href="javascript:;" download class="img-down toggle-radius mr6" title="下载图片"><i class="fa fa-download"></i></a>':"";s.group&&(a+=s.play?'<a href="javascript:;" class="toggle-palay toggle-radius mr6" title="播放图片"><i class="fa fa-play"></i></a>':"",s.thumbs&&(a+='<a href="javascript:;" class="toggle-thumbs toggle-radius mr6" title="查看更多图片"><i class="fa fa-th-large"></i></a>',e+=i)),a+=s.zoom?'<a href="javascript:;" class="toggle-zoom toggle-radius mr6" title="切换图片缩放"><i class="fa fa-search"></i></a>':"",a+=s.full?'<a href="javascript:;" class="hide-sm toggle-full toggle-radius mr6" title="切换全屏"><i class="fa fa-expand"></i></a>':"",a+='<a href="javascript:;" title="关闭" class="icon-close toggle-radius"><svg viewBox="0 0 1024 1024" class="icon em12"><path d="M573.44 512.128l237.888 237.696a43.328 43.328 0 0 1 0 59.712 43.392 43.392 0 0 1-59.712 0L513.728 571.84 265.856 819.712a44.672 44.672 0 0 1-61.568 0 44.672 44.672 0 0 1 0-61.568L452.16 510.272 214.208 272.448a43.328 43.328 0 0 1 0-59.648 43.392 43.392 0 0 1 59.712 0l237.952 237.76 246.272-246.272a44.672 44.672 0 0 1 61.568 0 44.672 44.672 0 0 1 0 61.568L573.44 512.128z"></path></svg></a>',W.append('<div class="'+R+'" id="'+M+'"><div class="modal-backdrop imgbox-bg"></div><div class="imgbox-an">'+a+"</div>"+e+"</div>"),I=t(T),m(),f()}}function g(t,e){var i=I.find(".imgbox-an .toggle-palay");e>1?i.show():i.hide();var a=e>1?'<badge class="b-black counter">'+(t+1)+"/"+e+"</badge>":"";I.find(".counter-con").html(a)}function m(){var i=T+" .swiper-imgbox",a=~~((t(e).width()+800)/310),n={};n.speed=100*a,n.zoom={maxRatio:t(e).width()<768?3:2},n.autoplay={disableOnInteraction:!1},n.grabCursor=!0,n.navigation={nextEl:i+" .swiper-button-next",prevEl:i+" .swiper-button-prev"},n.keyboard={enabled:!0,onlyInViewport:!1},n.on={slideChange:function(){g(this.realIndex,this.slides.length)}},s.thumbs&&s.group&&(p(),n.thumbs={swiper:V,autoScrollOffset:~~(a/1.6)}),O.swiper=L=new Swiper(i,n)}function p(){var t=T+" .swiper-thumbsbox",e={watchSlidesVisibility:!0};e.navigation={nextEl:t+" .swiper-button-next",prevEl:t+" .swiper-button-prev"},e.slidesPerView="auto",e.freeMode=!0,e.freeModeSticky=!0,O.thumbs_swiper=V=new Swiper(t,e)}function f(){I.data("is_on")||(F(),I.on("click",".img-close,.imgbox-bg,.imgbox-an .icon-close",k),I.on("click",".imgbox-an .toggle-thumbs,.hide-but",function(){I.toggleClass("show-thumb")}),I.on("click",".imgbox-an .img-down",function(){var e=t(this),i=I.find(".swiper-imgbox .swiper-slide-active img"),a=i.attr("data-src")||i.attr("src"),s=a.substring(a.lastIndexOf("/")+1)||a;e.attr("href",a).attr("download",s)}),I.on("click",".imgbox-an .toggle-palay",function(){var e=t(this);e.hasClass("is-play")?L.autoplay.stop():L.autoplay.start(),e.toggleClass("is-play")}),I.on("click",".imgbox-an .toggle-zoom",function(){var e=t(this);L.zoom.toggle(),e.toggleClass("is-zoom")}),I.on("click",".imgbox-an .toggle-full",function(){document.fullscreenElement?v():h()}),I.data("is_on",!0))}function h(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(),t(T+" .imgbox-an .toggle-full .fa").removeClass("fa-expand").addClass("fa-compress"),t(T+".show").addClass("full-screen")}function v(){document.fullscreenElement&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()),t(T+" .imgbox-an .toggle-full .fa").removeClass("fa-compress").addClass("fa-expand"),I.removeClass("full-screen")}function b(t){return-1==t.indexOf("base64,")&&t.length<300?t.replace(/(.*\/)(.*)(-\d+x\d+\.)(.*)/g,"$1$2.$4").replace(/\??x-oss-process(.*)/,""):t}function w(e){var i=e.offset(),a=i.top,s=i.left,n=t(document).scrollTop(),o=e.height(),r=e.width(),l=a-n+o/2,c=s+r/2;I.attr("style","--imgbox-origin-top:"+l+"px;--imgbox-origin-left:"+c+"px;")}function x(){var e=t(T+" .imgbox-an .toggle-thumbs,.hide-but");s.thumbs&&e.length&&(L.slides.length>1?e.show():(I.removeClass("show-thumb"),e.hide()))}function y(){var t=e.innerWidth;if(!t){var i=document.documentElement.getBoundingClientRect();t=i.right-Math.abs(i.left)}return document.body.clientWidth<t}function C(){var t=W.data("scrollbar-width");if(void 0!==t)return t;var e=document.createElement("div");e.className="modal-scrollbar-measure",W.append(e);var i=e.offsetWidth-e.clientWidth;return W[0].removeChild(e),W.data("scrollbar-width",i),i}function _(){var e=parseInt(W.css("padding-right")||0,10),i=C();y()&&(W.css("padding-right",e+i),D.each(function(e,a){var s=a.style.paddingRight,n=t(a).css("padding-right");t(a).data("padding-right",s).css("transition","none").css("padding-right",parseFloat(n)+i+"px")}))}function z(t){_(),W.addClass("imgbox-show"),w(t),I.addClass("show").removeClass("hide")}function k(){W.removeClass("imgbox-show").css("padding-right",""),D.css("padding-right",""),setTimeout(function(){D.css("transition","")},10),I.addClass("hideing").removeClass("show"),v(),setTimeout(function(){I.removeClass("hideing").addClass("hide").attr("style",""),t(".toggle-palay.is-play").removeClass("is-play");try{L.zoom.out(),L.autoplay.stop()}catch(t){console.log(t)}t(T+" .swiper-close").css({opacity:"",transform:""})},300)}function F(){I.on("touchmove pointermove MSPointerMove",function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}),I.minitouch({direction:"bottom",selector:".swiper-close",depreciation:100,onStart:!1,stop:function(t,e){var i=e.find("img").css("transform").replace(/[^0-9\-,]/g,"").split(",")[0];return i&&i>1},onIng:function(t,e,i,a){var s=(150-a)/80;s=s<1&&s>.2&&s,e.css("opacity",s)},inEnd:function(t,e){e.css({opacity:""})},onEnd:function(t,e){I.attr("style","--imgbox-origin-top:"+i+"px;--imgbox-origin-left:conter;");var i=e.height();e.css({transform:"translate3D(0px, "+i+"px, 0px)",transition:".2s linear",opacity:0}),setTimeout(k,150)}})}function S(t){var e=t.attr("src")||t.attr("box-img"),i=t.attr("data-src");if(!e&&!i)return"";var a=t.attr("data-full-url")||b(i||e),s=e==a?'<img src="'+a+'" class="lazyloaded">':'<img src="'+e+'" data-src="'+a+'"  class="lazyload"><div class="swiper-lazy-preloader"></div>',n='<div class="swiper-slide"><div class="swiper-close"><div class="swiper-zoom-container"><div class="absolute img-close"></div>'+s+"</div></div></div>";return n}function E(t){var e=t.attr("data-src")||t.attr("src");if(!e)return"";var i='<img data-src="'+e+'"  class="lazyload fit-cover">',a='<div class="swiper-slide">'+i+"</div>";return a}function q(t){var e=t.attr("data-src")||t.attr("src");if(!e)return!1;e=b(e);var i=t.parent("a");if(!i.length)return!1;var a=i.attr("box-img")||i.attr("href");return a=b(a),a&&(-1==a.indexOf(e)||-1==e.indexOf(a))}var R="mini-imgbox imgbox",M="mini-imgbox",j="imgbox_data",T="#"+M,I=t(T),O=e.Miniimgbox,L=O.swiper,V=O.thumbs_swiper,W=t("body"),D=t(".nav-fixed header");s.group||(s.thumbs=!1),n()}var a=function(t,e){return i(t,e,a.options)};a.options={group:!0,thumbs:!0,down:!0,play:!0,zoom:!0,full:!0,exclude:".no-imgbox,.avatar,.img-icon,.avatar-badge,.smilie-icon"},a.swiper="",a.thumbs_swiper="",e.Miniimgbox=a,tbquire(["swiper"],function(){t("link#swiper").length||t("head").append('<link type="text/css" id="swiper" rel="stylesheet" href="'+_win.uri+"/css/swiper.min.css?ver="+_win.ver+'">'),a.options.group="group"===_win.imgbox_type,a.options.thumbs=_win.imgbox_thumbs,a.options.down=_win.imgbox_down,a.options.play=_win.imgbox_play,a.options.zoom=_win.imgbox_zoom,a.options.full=_win.imgbox_full,a(".alone-imgbox-img,a[data-imgbox]"),a("img",".wp-posts-content"),a("img",".imgbox-container"),a(".box-img",".comment-content")})})(jQuery,window);